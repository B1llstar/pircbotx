<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UserHostmask.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pircbotx</a> &gt; <a href="index.source.html" class="el_package">org.pircbotx</a> &gt; <span class="el_source">UserHostmask.java</span></div><h1>UserHostmask.java</h1><pre class="source lang-java linenums">// Generated by delombok at Mon Apr 13 22:36:03 CEST 2020
/**
 * Copyright (C) 2010-2014 Leon Blakey &lt;lord.quackstar at gmail.com&gt;
 *
 * This file is part of PircBotX.
 *
 * PircBotX is free software: you can redistribute it and/or modify it under the
 * terms of the GNU General Public License as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option) any later
 * version.
 *
 * PircBotX is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * PircBotX. If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.pircbotx;

import com.google.common.base.Preconditions;
import lombok.NonNull;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.concurrent.AtomicSafeInitializer;
import org.apache.commons.lang3.concurrent.ConcurrentException;
import org.pircbotx.output.OutputUser;

/**
 * Represents any hostmask that may or may not be an actual user.
 *
 * @author Leon Blakey
 */
public class UserHostmask implements Comparable&lt;User&gt; {
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
<span class="fc" id="L36">	private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(UserHostmask.class);</span>
	@NonNull
	protected final PircBotX bot;
	
	/**
	 * Lazily created output since it might not ever be used
	 */
<span class="fc" id="L43">	protected final AtomicSafeInitializer&lt;OutputUser&gt; output = new AtomicSafeInitializer&lt;OutputUser&gt;(){</span>
		
		
		@Override
		protected OutputUser initialize() {
<span class="fc" id="L48">			return bot.getConfiguration().getBotFactory().createOutputUser(bot, UserHostmask.this);</span>
		}
	};
	
	/**
	 * Extban prefix if in format extban:nick or extban:nick!login@hostmask
	 */
	private final String extbanPrefix;
	
	/**
	 * Current nick of the user (nick!login@hostname).
	 */
	private String nick;
	
	/**
	 * Login of the user (nick!login@hostname).
	 */
	private String login;
	
	/**
	 * Hostname of the user (nick!login@hostname).
	 */
	private String hostname;
	
<span class="fc" id="L72">	protected UserHostmask(PircBotX bot, String rawHostmask) {</span>
		try {
<span class="fc" id="L74">			Preconditions.checkArgument(StringUtils.isNotBlank(rawHostmask), &quot;Cannot parse blank hostmask&quot;);</span>
<span class="fc" id="L75">			this.bot = bot;</span>
<span class="pc bpc" id="L76" title="1 of 4 branches missed.">			if (StringUtils.contains(rawHostmask, &quot;!&quot;) &amp;&amp; StringUtils.contains(rawHostmask, &quot;@&quot;)) {</span>
<span class="fc" id="L77">				String[] hostmaskParts = StringUtils.split(rawHostmask, &quot;!@&quot;);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">				if (hostmaskParts.length &gt;= 3) {</span>
<span class="fc" id="L79">					this.nick = hostmaskParts[0];</span>
<span class="fc" id="L80">					this.login = hostmaskParts[1];</span>
<span class="fc" id="L81">					this.hostname = hostmaskParts[2];</span>
				} else {
<span class="nc" id="L83">					this.nick = rawHostmask;</span>
<span class="nc" id="L84">					this.login = null;</span>
<span class="nc" id="L85">					this.hostname = null;</span>
				}
<span class="fc" id="L87">			} else {</span>
<span class="fc" id="L88">				this.nick = rawHostmask;</span>
<span class="fc" id="L89">				this.login = null;</span>
<span class="fc" id="L90">				this.hostname = null;</span>
			}
<span class="fc bfc" id="L92" title="All 2 branches covered.">			if (nick.contains(&quot;:&quot;)) {</span>
<span class="fc" id="L93">				String[] nickParts = StringUtils.split(nick, &quot;:&quot;);</span>
<span class="fc" id="L94">				this.extbanPrefix = nickParts[0];</span>
<span class="fc" id="L95">				this.nick = nickParts[1];</span>
<span class="fc" id="L96">			} else {</span>
<span class="fc" id="L97">				this.extbanPrefix = null;</span>
			}
<span class="nc" id="L99">		} catch (Exception e) {</span>
<span class="nc" id="L100">			throw new RuntimeException(&quot;Unable to parse hostmask &quot; + rawHostmask, e);</span>
<span class="fc" id="L101">		}</span>
<span class="fc" id="L102">	}</span>
	
<span class="fc" id="L104">	protected UserHostmask(UserHostmask otherHostmask) {</span>
<span class="fc" id="L105">		this.bot = otherHostmask.getBot();</span>
<span class="fc" id="L106">		this.nick = otherHostmask.getNick();</span>
<span class="fc" id="L107">		this.login = otherHostmask.getLogin();</span>
<span class="fc" id="L108">		this.hostname = otherHostmask.getHostname();</span>
<span class="fc" id="L109">		this.extbanPrefix = otherHostmask.getExtbanPrefix();</span>
<span class="fc" id="L110">	}</span>
	
	protected void updateHostmask(@NonNull UserHostmask userHostmask) {
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">		if (userHostmask == null) {</span>
<span class="nc" id="L114">			throw new java.lang.NullPointerException(&quot;userHostmask&quot;);</span>
		}
<span class="pc bpc" id="L116" title="1 of 4 branches missed.">		if (StringUtils.isNotBlank(userHostmask.getHostname()) &amp;&amp; !userHostmask.getHostname().equals(getHostname())) {</span>
<span class="fc" id="L117">			log.trace(&quot;Updating hostname to {} for user {}!{}@{}&quot;, userHostmask.getHostname(), getNick(), getLogin(), getHostname());</span>
<span class="fc" id="L118">			this.hostname = userHostmask.getHostname();</span>
		}
<span class="pc bpc" id="L120" title="1 of 4 branches missed.">		if (StringUtils.isNotBlank(userHostmask.getLogin()) &amp;&amp; !userHostmask.getLogin().equals(getLogin())) {</span>
<span class="fc" id="L121">			log.trace(&quot;Updating login to {} for user {}!{}@{}&quot;, userHostmask.getLogin(), getNick(), getLogin(), getHostname());</span>
<span class="fc" id="L122">			this.login = userHostmask.getLogin();</span>
		}
<span class="fc" id="L124">	}</span>
	
	/**
	 * The full hostmask of the user in extban:user!login@hostname format. If
	 * there's no extban prefix extban: is not returned. If there's no login nor
	 * hostmask, meaning this is a service or the IRCd server &quot;user&quot;, just the
	 * nick is returned
	 */
	@NonNull
	public String getHostmask() {
<span class="fc" id="L134">		StringBuilder hostmask = new StringBuilder();</span>
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">		if (StringUtils.isNotBlank(extbanPrefix)) {</span>
<span class="nc" id="L136">			hostmask.append(extbanPrefix).append(':');</span>
		}
<span class="fc" id="L138">		hostmask.append(nick);</span>
<span class="pc bpc" id="L139" title="1 of 4 branches missed.">		if (StringUtils.isNotBlank(login) || StringUtils.isNotBlank(hostname)) {</span>
<span class="fc" id="L140">			hostmask.append('!').append(login).append('@').append(hostname);</span>
		}
<span class="fc" id="L142">		return hostmask.toString();</span>
	}
	
	/**
	 * Alias of {@link #getLogin() }
	 */
	public String getIdent() {
<span class="nc" id="L149">		return getLogin();</span>
	}
	
	/**
	 * Send a line to the user.
	 *
	 * @return A {@link OutputUser} for this user
	 */
	public OutputUser send() {
		try {
<span class="fc" id="L159">			return output.get();</span>
<span class="nc" id="L160">		} catch (ConcurrentException ex) {</span>
<span class="nc" id="L161">			throw new RuntimeException(&quot;Could not generate OutputChannel for &quot; + getNick(), ex);</span>
		}
	}
	
	/**
	 * Compare {@link #getNick()} with {@link String#compareToIgnoreCase(java.lang.String)
	 * }. This is useful for sorting lists of User objects.
	 *
	 * @param other Other user to compare to
	 * @return the result of calling compareToIgnoreCase user nicks.
	 */
	@Override
	public int compareTo(User other) {
<span class="fc" id="L174">		return getNick().compareToIgnoreCase(other.getNick());</span>
	}
	
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;T extends PircBotX&gt; T getBot() {
<span class="fc" id="L179">		return (T)bot;</span>
	}
	
	@java.beans.ConstructorProperties({&quot;bot&quot;, &quot;extbanPrefix&quot;, &quot;nick&quot;, &quot;login&quot;, &quot;hostname&quot;})
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
<span class="fc" id="L185">	protected UserHostmask(@NonNull final PircBotX bot, final String extbanPrefix, final String nick, final String login, final String hostname) {</span>
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">		if (bot == null) {</span>
<span class="nc" id="L187">			throw new java.lang.NullPointerException(&quot;bot&quot;);</span>
		}
<span class="fc" id="L189">		this.bot = bot;</span>
<span class="fc" id="L190">		this.extbanPrefix = extbanPrefix;</span>
<span class="fc" id="L191">		this.nick = nick;</span>
<span class="fc" id="L192">		this.login = login;</span>
<span class="fc" id="L193">		this.hostname = hostname;</span>
<span class="fc" id="L194">	}</span>
	
	@java.lang.Override
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public boolean equals(final java.lang.Object o) {
<span class="fc bfc" id="L200" title="All 2 branches covered.">		if (o == this) return true;</span>
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">		if (!(o instanceof UserHostmask)) return false;</span>
<span class="fc" id="L202">		final UserHostmask other = (UserHostmask)o;</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">		if (!other.canEqual((java.lang.Object)this)) return false;</span>
<span class="fc" id="L204">		final java.lang.Object this$bot = this.getBot();</span>
<span class="fc" id="L205">		final java.lang.Object other$bot = other.getBot();</span>
<span class="pc bpc" id="L206" title="4 of 6 branches missed.">		if (this$bot == null ? other$bot != null : !this$bot.equals(other$bot)) return false;</span>
<span class="fc" id="L207">		final java.lang.Object this$nick = this.getNick();</span>
<span class="fc" id="L208">		final java.lang.Object other$nick = other.getNick();</span>
<span class="pc bpc" id="L209" title="3 of 6 branches missed.">		if (this$nick == null ? other$nick != null : !this$nick.equals(other$nick)) return false;</span>
<span class="fc" id="L210">		final java.lang.Object this$login = this.getLogin();</span>
<span class="fc" id="L211">		final java.lang.Object other$login = other.getLogin();</span>
<span class="pc bpc" id="L212" title="2 of 6 branches missed.">		if (this$login == null ? other$login != null : !this$login.equals(other$login)) return false;</span>
<span class="fc" id="L213">		final java.lang.Object this$hostname = this.getHostname();</span>
<span class="fc" id="L214">		final java.lang.Object other$hostname = other.getHostname();</span>
<span class="pc bpc" id="L215" title="2 of 6 branches missed.">		if (this$hostname == null ? other$hostname != null : !this$hostname.equals(other$hostname)) return false;</span>
<span class="fc" id="L216">		return true;</span>
	}
	
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	protected boolean canEqual(final java.lang.Object other) {
<span class="fc" id="L222">		return other instanceof UserHostmask;</span>
	}
	
	@java.lang.Override
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public int hashCode() {
<span class="fc" id="L229">		final int PRIME = 59;</span>
<span class="fc" id="L230">		int result = 1;</span>
<span class="fc" id="L231">		final java.lang.Object $bot = this.getBot();</span>
<span class="pc bpc" id="L232" title="1 of 2 branches missed.">		result = result * PRIME + ($bot == null ? 43 : $bot.hashCode());</span>
<span class="fc" id="L233">		final java.lang.Object $nick = this.getNick();</span>
<span class="pc bpc" id="L234" title="1 of 2 branches missed.">		result = result * PRIME + ($nick == null ? 43 : $nick.hashCode());</span>
<span class="fc" id="L235">		final java.lang.Object $login = this.getLogin();</span>
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">		result = result * PRIME + ($login == null ? 43 : $login.hashCode());</span>
<span class="fc" id="L237">		final java.lang.Object $hostname = this.getHostname();</span>
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">		result = result * PRIME + ($hostname == null ? 43 : $hostname.hashCode());</span>
<span class="fc" id="L239">		return result;</span>
	}
	
	/**
	 * Extban prefix if in format extban:nick or extban:nick!login@hostmask
	 */
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public String getExtbanPrefix() {
<span class="fc" id="L248">		return this.extbanPrefix;</span>
	}
	
	/**
	 * Current nick of the user (nick!login@hostname).
	 */
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public String getNick() {
<span class="fc" id="L257">		return this.nick;</span>
	}
	
	/**
	 * Login of the user (nick!login@hostname).
	 */
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public String getLogin() {
<span class="fc" id="L266">		return this.login;</span>
	}
	
	/**
	 * Hostname of the user (nick!login@hostname).
	 */
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public String getHostname() {
<span class="fc" id="L275">		return this.hostname;</span>
	}
	
	@java.lang.Override
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	public java.lang.String toString() {
<span class="fc" id="L282">		return &quot;UserHostmask(extbanPrefix=&quot; + this.getExtbanPrefix() + &quot;, nick=&quot; + this.getNick() + &quot;, login=&quot; + this.getLogin() + &quot;, hostname=&quot; + this.getHostname() + &quot;)&quot;;</span>
	}
	
	/**
	 * Current nick of the user (nick!login@hostname).
	 */
	@java.lang.SuppressWarnings(&quot;all&quot;)
	@javax.annotation.Generated(&quot;lombok&quot;)
	protected void setNick(final String nick) {
<span class="fc" id="L291">		this.nick = nick;</span>
<span class="fc" id="L292">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>